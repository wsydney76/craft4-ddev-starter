{# @param textKey String key for siteInfo.textModules #}
{# @param heading String Heading text #}
{# @param caption String Button text #}

{% set textKey = textKey ?? 'default' %}
{% set heading = heading ?? '' %}
{% set caption = caption ?? 'Show Media'|t %}

{% set textModule = siteInfo.textModules.key(textKey).one %}
{% set privacyEntry = craft.entries.section('legal').type('privacy').one %}

<div x-data="{acceptOnce: false}" class="my-8">
    <template x-if="$store.consent.mediaCookiesAllowed || acceptOnce">
        {% block media %}{% endblock %}
    </template>

    <div x-show="!$store.consent.mediaCookiesAllowed  && !acceptOnce"
         class="border border-gray-700 bg-gray-50 rounded p-8 dark:bg-primary">

        {% if heading %}
            <div class="mb-8 text-xl font-bold">
                {{ heading }}
            </div>
        {% endif %}

        {% block content %}{% endblock %}

        {% if textModule %}
            <div class="mb-2">
                <div class="mb-1 text-lg font-bold">
                    {{ textModule.heading }}
                </div>
                <div>
                    {{ textModule.text|nl2br }}
                </div>
            </div>
        {% endif %}

        <div class="mt-8 space-x-4">

            {% if customConfig.useCookieConsent != 'none' %}

                {% include '_layouts/partials/button.twig' with {
                    tag: 'button',
                    caption: 'Allow once'|t,
                    xOnClick: "acceptOnce = true"
                } only %}

                {% include '_layouts/partials/button.twig' with {
                    tag: 'button',
                    caption: 'Always allow'|t,
                    xOnClick: "$store.consent.allowMediaCookies()"
                } only %}

            {% else %}

                {% include '_layouts/partials/button.twig' with {
                    tag: 'button',
                    caption: caption,
                    xOnClick: "acceptOnce = true"
                } only %}

            {% endif %}

            {% if privacyEntry %}
                {{ privacyEntry.link }}
            {% endif %}

        </div>
    </div>
</div>